{% extends "base.html" %}
{% block title %}Home — Attendance{% endblock %}
{% block header %}
<h1 class="text-2xl font-semibold">Search</h1>
<p class="text-sm text-slate-500">Find a student by name or index number.</p>
{% endblock %}
{% block content %}
<div class="card p-5">
  <div class="flex gap-3">
    <input id="q" class="input flex-1" placeholder="Type name or index (e.g., Ama, UG1234567)" />
    <button id="searchBtn" class="btn-primary">Search</button>
  </div>
  <div class="text-xs text-slate-500 mt-2">Press Enter to search • Add demo data below</div>
</div>

<div class="card p-5 mt-4">
  <h2 class="font-semibold mb-2">Add sample student</h2>
  <div class="grid md:grid-cols-2 gap-2">
    <input id="idx" class="input" placeholder="Index No e.g. UG1234567" />
    <input id="name" class="input" placeholder="Full name e.g. Ama Mensah" />
  </div>
  <button id="addBtn" class="btn-outline mt-2">Add</button>
</div>

<div class="card p-0 mt-4 overflow-hidden">
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr><th class="w-24">ID</th><th>Index No</th><th>Name</th><th class="w-32">Actions</th></tr>
      </thead>
      <tbody id="resultsBody">
        <tr><td colspan="4" class="py-6 text-center text-slate-500">No results yet.</td></tr>
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
const el = id => document.getElementById(id);
const api = async (p,o={})=>{
  const r = await fetch(p,{headers:{'Content-Type':'application/json'},...o});
  if(!r.ok) throw new Error(await r.text()); return r.json();
};
async function search(){
  const q = el('q').value.trim();
  const url = q ? `/students?search=${encodeURIComponent(q)}` : '/students';
  const rows = await api(url);
  const body = el('resultsBody');
  body.innerHTML = rows.length ? rows.map(s=>`
    <tr>
      <td>${s.id}</td><td>${s.index_no}</td><td>${s.full_name}</td>
      <td><button class="btn-ghost" onclick="alert('Open student ${s.id}')">View</button></td>
    </tr>`).join('')
    : `<tr><td colspan="4" class="py-6 text-center text-slate-500">No matches.</td></tr>`;
}
el('searchBtn').onclick = search;
el('q').addEventListener('keydown', e => { if(e.key==='Enter') search(); });

el('addBtn').onclick = async ()=>{
  const index_no = el('idx').value.trim();
  const full_name = el('name').value.trim();
  if(!index_no || !full_name) return alert('Provide both fields');
  await api('/students',{method:'POST',body:JSON.stringify({index_no, full_name})});
  el('idx').value = ""; el('name').value = "";
  search();
};
</script>
{% endblock %}
