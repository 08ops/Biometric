{% extends "base.html" %}
{% block title %}Home ‚Äî Attendance{% endblock %}
{% block header %}
<h1 class="text-2xl font-semibold">Search</h1>
<p class="text-sm text-slate-500">Find a student by name or index number.</p>
{% endblock %}
{% block content %}
<div class="card p-5">
  <div class="flex gap-3">
    <input id="q" class="input flex-1" placeholder="Type name or index (e.g., Ama, UG1234567)" />
    <button id="searchBtn" class="btn-primary">Search</button>
  </div>
  <div class="text-xs text-slate-500 mt-2">Press Enter to search ‚Ä¢ Add demo data below</div>

    <!-- üëá New result display area -->
  <div id="searchResult" class="mt-4 text-sm text-slate-700"></div>
</div>

<div class="card p-5 mt-4">
  <h2 class="font-semibold mb-2">Add sample student</h2>
 

<!-- Add Paho MQTT JS client just before closing body tag -->


  <div class="grid md:grid-cols-2 gap-2">
    <input id="idx" class="input" placeholder="Index No e.g. UG1234567" />
    <input id="name" class="input" placeholder="Full name e.g. Ama Mensah" />
    <input id="rfid" class="input" placeholder="RFID UID (optional)" />
    <input id="class" class="input" placeholder="Class (optional)" />
    <input id="photo" class="input" placeholder="Photo path (optional)" />
  </div>
  <button id="addBtn" class="btn-outline mt-2">Add</button>
</div>

<!-- Toast Notification Container -->
<div id="toast" class="fixed top-5 right-5 bg-slate-800 text-white px-16 py-8 rounded shadow-lg opacity-0 transition-opacity duration-300 z-50"></div>

<div class="card p-0 mt-4 overflow-hidden">
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr><th class="w-24">ID</th><th>Index No</th><th>Name</th><th class="w-32">Actions</th></tr>
      </thead>
      <tbody id="resultsBody">
        <tr><td colspan="4" class="py-6 text-center text-slate-500">No results yet.</td></tr>
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
{% block scripts %}
<<<<<<< HEAD
<script>
const el = id => document.getElementById(id);
// Toast notification function
function showToast(message, duration = 3000) {
  const toast = document.getElementById("toast");
  toast.textContent = message;
  toast.classList.remove("opacity-0");
  toast.classList.add("opacity-100");

  // Hide after duration
  setTimeout(() => {
    toast.classList.remove("opacity-100");
    toast.classList.add("opacity-0");
  }, duration);
}

const api = async (p, o = {}) => {
  const r = await fetch(p, {
    headers: { 'Content-Type': 'application/json' },
    ...o
  });

  if (r.status === 404) {
    const data = await r.json();
    return { error: data.message || "Not found" };
  }

  if (!r.ok) throw new Error(await r.text());
  return r.json();
};

async function search() {
  const q = el('q').value.trim();
  const url = q ? `/students?search=${encodeURIComponent(q)}` : '/students';
  const resultBox = el('searchResult');

  try {
    const rows = await api(url);

    if (rows.length === 0) {
      resultBox.innerHTML = '';
      showToast('No student found ‚ùå');
      return;
    }

    const student = rows[0];
   resultBox.innerHTML = `
  <div class="p-3 bg-green-50 border border-green-200 rounded relative">
    <button onclick="document.getElementById('searchResult').innerHTML=''"
            class="absolute top-1 right-2 text-sm text-red-500 hover:underline">
      ‚úñ Close
    </button>
    <div><strong>ID:</strong> ${student.id}</div>
    <div><strong>Name:</strong> ${student.full_name}</div>
    <div><strong>Index No:</strong> ${student.index_no}</div>
  </div>
`;

  } catch (err) {
    resultBox.innerHTML = '';
    showToast('Error fetching student ‚ùå');
  }
}



el('searchBtn').onclick = search;
el('q').addEventListener('keydown', e => { if(e.key==='Enter') search(); });

el('addBtn').onclick = async () => {
  const index_no = el('idx').value.trim();
  const full_name = el('name').value.trim();

  if (!index_no || !full_name) {
    showToast('Provide both fields');
    return;
  }

  try {
    await api('/add-student', {
      method: 'POST',
      body: JSON.stringify({
        registration_number: index_no,
        name: full_name,
        rfid_uid: null,
        class: null,
        photo_path: null
      })
    });

    el('idx').value = "";
    el('name').value = "";
    showToast('Student added successfully ‚úÖ');

    // Don't call search() here anymore
    // Optionally clear previous result box
    el('searchResult').innerHTML = '';

  } catch (err) {
    showToast('Error adding student ‚ùå');
  }
};

</script>
=======
<script src="/static/js/home.js"></script>
<script src="https://unpkg.com/paho-mqtt/mqttws31.min.js"></script>
>>>>>>> 883f3156acf0ca63d9cdf781aaa43342dbf3a1e3
{% endblock %}
